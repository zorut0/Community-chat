{
  "info": {
    "name": "Mona360 Community Chat - collection",
    "postman_id": "mona360-collection",
    "description": "Collection to exercise users, auth, communities and messages endpoints",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth - Login",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "url": { "raw": "{{baseUrl}}/v1/auth/login", "host": ["{{baseUrl}}"], "path": ["v1","auth","login"] },
        "body": { "mode": "raw", "raw": "{ \"email\": \"alice@example.com\", \"password\": \"password1\" }" }
      },
      "event": [{ "listen": "test", "script": { "exec": ["pm.test('login returns access_token', function(){"," var j = pm.response.json();"," pm.expect(j.access_token).to.exist;","});" ] }}]
    },
    {
      "name": "Users - create",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{testUserToken}}" }
        ],
        "url": { "raw": "{{baseUrl}}/v1/users", "host": ["{{baseUrl}}"], "path": ["v1","users"] },
        "body": { "mode": "raw", "raw": "{\n  \"name\": \"Alice\",\n  \"email\": \"alice@example.com\",\n  \"password\": \"password1\",\n  \"role\": \"user\"\n}" }
      },
      "event": [{ "listen": "test", "script": { "exec": ["pm.test('create user 200', function(){"," pm.response.to.have.status(200);","});" ] }}]
    },
    {
      "name": "Users - list",
      "request": { "method": "GET", "header": [{"key":"Authorization","value":"Bearer {{testUserToken}}"}], "url": { "raw": "{{baseUrl}}/v1/users", "host": ["{{baseUrl}}"], "path": ["v1","users"] } },
      "event": [{ "listen": "test", "script": { "exec": ["pm.test('list users ok', function(){ pm.response.to.have.status(200); });" ] }}]
    },
    {
      "name": "Communities - create",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{testUserToken}}"}],
        "url": { "raw": "{{baseUrl}}/v1/communities", "host": ["{{baseUrl}}"], "path": ["v1","communities"] },
        "body": { "mode": "raw", "raw": "{ \"name\": \"Local Devs\", \"description\": \"desc\", \"owner\": \"{{testUserId}}\" }" }
      },
      "event": [{ "listen": "test", "script": { "exec": ["pm.test('create community ok', function(){ pm.response.to.have.status(200); });" ] }}]
    },
    {
      "name": "Communities - join",
      "request": {
        "method": "POST",
        "header": [{"key":"Authorization","value":"Bearer {{testUserToken}}"},{"key":"Content-Type","value":"application/json"}],
        "url": { "raw": "{{baseUrl}}/v1/communities/{{testCommunityId}}/join", "host": ["{{baseUrl}}"], "path": ["v1","communities","{{testCommunityId}}","join"] },
        "body": { "mode": "raw", "raw": "{ \"uid\": \"{{testUserId}}\" }" }
      },
      "event": [{ "listen": "test", "script": { "exec": ["pm.test('join ok', function(){ pm.response.to.have.status(200); });" ] }}]
    },
    {
      "name": "Messages - send",
      "request": {
        "method": "POST",
        "header": [{"key":"Content-Type","value":"application/json"},{"key":"Authorization","value":"Bearer {{testUserToken}}"}],
        "url": { "raw": "{{baseUrl}}/v1/messages", "host": ["{{baseUrl}}"], "path": ["v1","messages"] },
        "body": { "mode": "raw", "raw": "{ \"uid\": \"{{testUserId}}\", \"cid\": \"{{testCommunityId}}\", \"text\": \"Hello world from postman tests\" }" }
      },
      "event": [{ "listen": "test", "script": { "exec": ["pm.test('send ok', function(){ pm.response.to.have.status(200); });" ] }}]
    },
    {
      "name": "Messages - list by community",
      "request": { "method": "GET", "header": [{"key":"Authorization","value":"Bearer {{testUserToken}}"}], "url": { "raw": "{{baseUrl}}/v1/messages/community/{{testCommunityId}}", "host": ["{{baseUrl}}"], "path": ["v1","messages","community","{{testCommunityId}}"] } , "event": [{ "listen": "test", "script": { "exec": ["pm.test('list messages ok', function(){ pm.response.to.have.status(200); });" ] }}] }
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "http://127.0.0.1:8000" },
    { "key": "testUserToken", "value": "000000000000000000000000" },
    { "key": "testUserId", "value": "000000000000000000000000" },
    { "key": "testCommunityId", "value": "000000000000000000000001" }
  ]
}
